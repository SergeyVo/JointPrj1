//-------------------------------------------------------------------------------------------------------------------------------------
#include "led_run.h"

//-----------------------------------------------------Ports definitions---------------------------------------------------------------


//-----------------------------------------------------Defines-------------------------------------------------------------------------
#define  FLASH_TIME  80         //ms
#define  LEDS        11           //11 leds

//-----------------------------------------------------Functions-----------------------------------------------------------------------
void                          fvSetUp();               //Setup
void                          fvSpark(char cLed);

//-----------------------------------------------------Varables------------------------------------------------------------------------

//-----------------------------------------------------Constants-----------------------------------------------------------------------
char const ccPort[LEDS] = {PIN_A0,PIN_A1,PIN_A2,PIN_A4,PIN_A5,PIN_C0,PIN_C1,PIN_C2,PIN_C3,PIN_C4,PIN_C5};

//-----------------------------------------------------Source--------------------------------------------------------------------------

//=====================================================================================================================================
#zero_ram

void main()
{
char cLedActive = 0;

fvSetup();

while(TRUE)
   {
   restart_wdt();
   fvSpark(ccPort[cLedActive]);

   if(bit_test(PORTA,3))
      {
      cLedActive++;
      if(cLedActive >= LEDS)
         cLedActive = 0;
      }
   else
      {
      if(cLedActive <= 0)
         cLedActive = LEDS;
      cLedActive--;
      }
   }
}
//=====================================================================================================================================

//-------------------------------------------------------------------------------------------------------------------------------------
void  fvSetUp()
{
setup_adc_ports(NO_ANALOGS|VSS_VDD);
setup_adc(ADC_OFF);
setup_timer_0(RTCC_INTERNAL);setup_wdt(WDT_2304MS);
setup_timer_1(T1_DISABLED);
setup_comparator(NC_NC_NC_NC);
setup_vref(FALSE);
}
//-------------------------------------------------------------------------------------------------------------------------------------

//-------------------------------------------------------------------------------------------------------------------------------------
void fvSpark(char cLed)
{
output_low(cLed);
delay_ms(FLASH_TIME);
output_float(cLed);
}
//-------------------------------------------------------------------------------------------------------------------------------------
