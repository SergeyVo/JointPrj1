//-------------------------------------------------------------------------------------------------------------------------------------
#include "led_run.h"

//-----------------------------------------------------Ports definitions---------------------------------------------------------------


//-----------------------------------------------------Defines-------------------------------------------------------------------------
#define  FLASH_TIME  35         //ms
#define  LEDS        11           //11 leds

//-----------------------------------------------------Functions-----------------------------------------------------------------------
void                          fvSetUp();               //Setup
void                          fvSpark(char cLed, unsigned char ucDelay);

//-----------------------------------------------------Varables------------------------------------------------------------------------

//-----------------------------------------------------Constants-----------------------------------------------------------------------
char const ccPort[LEDS] = {PIN_A0,PIN_A1,PIN_A2,PIN_A4,PIN_A5,PIN_C0,PIN_C1,PIN_C2,PIN_C3,PIN_C4,PIN_C5};
#rom 0x2100 = {35, 7}

//-----------------------------------------------------Source--------------------------------------------------------------------------

//=====================================================================================================================================
#zero_ram

void main()
{
char cLedActive;
unsigned char ucFlashTime;
unsigned long uiDelay;

fvSetup();

ucFlashTime = read_eeprom(0);
uiDelay = (unsigned long) ucFlashTime * read_eeprom(1);

delay_ms(uiDelay);
if(bit_test(PORTA,3))
   {
   cLedActive = 0;
   while(cLedActive < LEDS)
      {
      restart_wdt();
      fvSpark(ccPort[cLedActive], ucFlashTime);
      cLedActive++;
      }
   }
else
   {
   cLedActive = LEDS;
   while(cLedActive > 0)
      {
      restart_wdt();
      cLedActive--;
      fvSpark(ccPort[cLedActive], ucFlashTime);
      }   
   }
reset_cpu();   
}
//=====================================================================================================================================

//-------------------------------------------------------------------------------------------------------------------------------------
void  fvSetUp()
{
setup_adc_ports(NO_ANALOGS|VSS_VDD);
setup_adc(ADC_OFF);
setup_timer_0(RTCC_INTERNAL);setup_wdt(WDT_2304MS);
setup_timer_1(T1_DISABLED);
setup_comparator(NC_NC_NC_NC);
setup_vref(FALSE);
}
//-------------------------------------------------------------------------------------------------------------------------------------

//-------------------------------------------------------------------------------------------------------------------------------------
void fvSpark(char cLed, unsigned char ucDelay)
{
output_low(cLed);
delay_ms(ucDelay);
output_float(cLed);
}
//-------------------------------------------------------------------------------------------------------------------------------------
